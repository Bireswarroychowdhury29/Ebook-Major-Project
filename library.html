<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Bookshelf</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --text-color: #333;
      --bg-color: #f5f5f5;
      --card-bg: #fff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    h1 {
      color: var(--primary-color);
      font-size: 2.5rem;
    }

    .search-bar {
      display: flex;
      gap: 10px;
      width: 50%;
    }

    .search-bar input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 1rem;
    }

    .search-bar button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: 0 20px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .search-bar button:hover {
      background-color: var(--secondary-color);
    }

    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
    }

    .filter-btn {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-btn:hover, .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 25px;
    }

    .book-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .book-cover {
      height: 280px;
      overflow: hidden;
    }

    .book-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .book-card:hover .book-cover img {
      transform: scale(1.05);
    }

    .book-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .book-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text-color);
    }

    .book-author {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }

    .book-meta {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #777;
    }

    .book-genre {
      background-color: #eef4fd;
      padding: 4px 8px;
      border-radius: 4px;
      color: var(--primary-color);
    }

    .loader {
      display: none;
      text-align: center;
      margin: 50px 0;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      display: none;
      text-align: center;
      color: #e74c3c;
      margin: 30px 0;
      font-size: 1.1rem;
    }

    .empty-state {
      display: none;
      text-align: center;
      margin: 50px 0;
    }

    .empty-state i {
      font-size: 4rem;
      color: #ddd;
      margin-bottom: 20px;
    }

    .empty-state p {
      font-size: 1.2rem;
      color: #999;
    }

    @media (max-width: 768px) {
      .search-bar {
        width: 100%;
      }

      header {
        flex-direction: column;
        gap: 20px;
      }

      .books-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .book-cover {
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Digital Bookshelf</h1>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search by title, author, or genre...">
        <button id="searchBtn"><i class="fas fa-search"></i></button>
      </div>
    </header>

    <div class="filters">
      <button class="filter-btn active" data-filter="all">All Books</button>
      <button class="filter-btn" data-filter="fiction">Fiction</button>
      <button class="filter-btn" data-filter="non-fiction">Non-Fiction</button>
      <button class="filter-btn" data-filter="children">Children's</button>
      <button class="filter-btn" data-filter="mystery">Mystery</button>
      <button class="filter-btn" data-filter="science">Science</button>
    </div>

    <div class="books-grid" id="booksGrid">
      <!-- Books will be populated here by JavaScript -->
    </div>

    <div class="loader" id="loader">
      <div class="spinner"></div>
      <p>Loading books...</p>
    </div>

    <div class="error-message" id="errorMessage">
      <p>Oops! Something went wrong while fetching the books. Please try again later.</p>
    </div>

    <div class="empty-state" id="emptyState">
      <i class="fas fa-book-open"></i>
      <p>No books found matching your criteria</p>
    </div>
  </div>

  <script>
    // Book data model example
    /*
    {
      _id: "ObjectId",
      title: "The Case of the Missing Smile",
      author: "Jane Smith",
      genre: "children",
      coverImage: "images/book-covers/missing-smile.jpg", 
      pageCount: 12,
      rating: 4.5,
      filepath: "books/case-of-the-missing-smile/"
    }
    */

    // DOM Elements
    const booksGrid = document.getElementById('booksGrid');
    const loader = document.getElementById('loader');
    const errorMessage = document.getElementById('errorMessage');
    const emptyState = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const filterBtns = document.querySelectorAll('.filter-btn');

    // Variables for state management
    let allBooks = [];
    let currentFilter = 'all';
    let searchTerm = '';

    // Fetch books from MongoDB API
    async function fetchBooks() {
      showLoader();
      hideError();
      hideEmptyState();

      try {
        // This will need to be replaced with your actual API endpoint that connects to MongoDB
        const response = await fetch('/api/books');
        
        if (!response.ok) {
          throw new Error('Failed to fetch books');
        }

        allBooks = await response.json();
        filterAndDisplayBooks();
        
      } catch (error) {
        console.error('Error fetching books:', error);
        showError();
      } finally {
        hideLoader();
      }
    }

    // Display books in the grid
    function displayBooks(books) {
      booksGrid.innerHTML = '';

      if (books.length === 0) {
        showEmptyState();
        return;
      }

      books.forEach(book => {
        const bookCard = document.createElement('div');
        bookCard.className = 'book-card';
        bookCard.dataset.id = book._id;
        
        // When a book card is clicked, open the book viewer with this book
        bookCard.addEventListener('click', () => openBookViewer(book));

        bookCard.innerHTML = `
          <div class="book-cover">
            <img src="${book.coverImage || 'images/default-cover.jpg'}" alt="${book.title}">
          </div>
          <div class="book-info">
            <div class="book-title">${book.title}</div>
            <div class="book-author">by ${book.author}</div>
            <div class="book-meta">
              <span class="book-genre">${book.genre}</span>
              <span class="book-rating">
                <i class="fas fa-star"></i> ${book.rating || 'N/A'}
              </span>
            </div>
          </div>
        `;

        booksGrid.appendChild(bookCard);
      });
    }

    // Filter and display books based on current filter and search term
    function filterAndDisplayBooks() {
      let filteredBooks = [...allBooks];

      // Apply category filter
      if (currentFilter !== 'all') {
        filteredBooks = filteredBooks.filter(book => book.genre.toLowerCase() === currentFilter);
      }

      // Apply search filter if there's a search term
      if (searchTerm.trim() !== '') {
        const term = searchTerm.toLowerCase().trim();
        filteredBooks = filteredBooks.filter(book => 
          book.title.toLowerCase().includes(term) || 
          book.author.toLowerCase().includes(term) || 
          book.genre.toLowerCase().includes(term)
        );
      }

      displayBooks(filteredBooks);
    }

    // Open the book viewer for the selected book
    function openBookViewer(book) {
      // Navigate to the existing index.html with the book ID as a parameter
      window.location.href = `index.html?bookId=${book._id}`;
    }

    // UI Helper Functions
    function showLoader() {
      loader.style.display = 'block';
    }

    function hideLoader() {
      loader.style.display = 'none';
    }

    function showError() {
      errorMessage.style.display = 'block';
    }

    function hideError() {
      errorMessage.style.display = 'none';
    }

    function showEmptyState() {
      emptyState.style.display = 'block';
    }

    function hideEmptyState() {
      emptyState.style.display = 'none';
    }

    // Event Listeners
    searchBtn.addEventListener('click', () => {
      searchTerm = searchInput.value;
      filterAndDisplayBooks();
    });

    searchInput.addEventListener('keyup', (e) => {
      if (e.key === 'Enter') {
        searchTerm = searchInput.value;
        filterAndDisplayBooks();
      }
    });

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active button UI
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update filter and refresh display
        currentFilter = btn.dataset.filter;
        filterAndDisplayBooks();
      });
    });

    // For development/demo purposes only - remove in production
    // This creates mock data when the actual API is not available
    function loadMockData() {
      allBooks = [
        {
          _id: '1',
          title: 'The Case of the Missing Smile',
          author: 'Jane Smith',
          genre: 'children',
          coverImage: 'images/img-1.jpg',
          pageCount: 12,
          rating: 4.5,
          filepath: 'books/case-of-the-missing-smile/'
        },
        {
          _id: '2',
          title: 'Mystery at Midnight',
          author: 'John Doe',
          genre: 'mystery',
          coverImage: 'images/img-3.jpg',
          pageCount: 24,
          rating: 4.2,
          filepath: 'books/mystery-at-midnight/'
        },
        {
          _id: '3',
          title: 'The Adventure Begins',
          author: 'Sarah Johnson',
          genre: 'fiction',
          coverImage: 'images/img-5.jpg',
          pageCount: 32,
          rating: 4.7,
          filepath: 'books/adventure-begins/'
        },
        {
          _id: '4',
          title: 'Space Explorers',
          author: 'Michael Brown',
          genre: 'science',
          coverImage: 'images/img-2.jpg',
          pageCount: 18,
          rating: 4.0,
          filepath: 'books/space-explorers/'
        },
        {
          _id: '5',
          title: 'The Hidden Truth',
          author: 'Emily Clark',
          genre: 'non-fiction',
          coverImage: 'images/img-4.jpg',
          pageCount: 42,
          rating: 4.8,
          filepath: 'books/hidden-truth/'
        },
        {
          _id: '6',
          title: 'Detective Peterson Returns',
          author: 'Jane Smith',
          genre: 'mystery',
          coverImage: 'images/img-2.jpg',
          pageCount: 28,
          rating: 4.4,
          filepath: 'books/detective-peterson/'
        }
      ];
      filterAndDisplayBooks();
      hideLoader();
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      // Comment out the appropriate line based on whether you're using the API or mock data
      // fetchBooks(); // Use this when your API is ready
      loadMockData(); // Use this for development/demo
    });
  </script>
</body>
</html>